From 5523a39238db6fbf0dbb8c10ee7b1a24b868160b Mon Sep 17 00:00:00 2001
From: "x1082265@ti.com" <dharma.b@mistralsolutions.com>
Date: Wed, 3 Nov 2021 09:52:50 +0530
Subject: [PATCH] workaround patch

---
 ...am571x-idk-pps.dtso => am571x-idk-pps.dts} |    0
 ...am572x-idk-pps.dtso => am572x-idk-pps.dts} |    0
 ...am574x-idk-pps.dtso => am574x-idk-pps.dts} |    0
 arch/arm/configs/tisdk_am57xx-evm_defconfig   | 7286 +++++++++++++++++
 drivers/net/ethernet/ti/Kconfig               |    6 +-
 drivers/net/ethernet/ti/cpts.c                |    1 -
 drivers/net/ethernet/ti/icss_iep.c            |    2 -
 7 files changed, 7289 insertions(+), 6 deletions(-)
 rename arch/arm/boot/dts/ti/{am571x-idk-pps.dtso => am571x-idk-pps.dts} (100%)
 rename arch/arm/boot/dts/ti/{am572x-idk-pps.dtso => am572x-idk-pps.dts} (100%)
 rename arch/arm/boot/dts/ti/{am574x-idk-pps.dtso => am574x-idk-pps.dts} (100%)
 create mode 100644 arch/arm/configs/tisdk_am57xx-evm_defconfig

diff --git a/arch/arm/boot/dts/ti/am571x-idk-pps.dtso b/arch/arm/boot/dts/ti/am571x-idk-pps.dts
similarity index 100%
rename from arch/arm/boot/dts/ti/am571x-idk-pps.dtso
rename to arch/arm/boot/dts/ti/am571x-idk-pps.dts
diff --git a/arch/arm/boot/dts/ti/am572x-idk-pps.dtso b/arch/arm/boot/dts/ti/am572x-idk-pps.dts
similarity index 100%
rename from arch/arm/boot/dts/ti/am572x-idk-pps.dtso
rename to arch/arm/boot/dts/ti/am572x-idk-pps.dts
diff --git a/arch/arm/boot/dts/ti/am574x-idk-pps.dtso b/arch/arm/boot/dts/ti/am574x-idk-pps.dts
similarity index 100%
rename from arch/arm/boot/dts/ti/am574x-idk-pps.dtso
rename to arch/arm/boot/dts/ti/am574x-idk-pps.dts
diff --git a/drivers/net/ethernet/ti/Kconfig b/drivers/net/ethernet/ti/Kconfig
index 65194a68ec78..f7952beb78b3 100644
--- a/drivers/net/ethernet/ti/Kconfig
+++ b/drivers/net/ethernet/ti/Kconfig
@@ -82,7 +82,7 @@ config TI_CPTS
 	tristate "TI Common Platform Time Sync (CPTS) Support"
 	depends on ARCH_OMAP2PLUS || ARCH_KEYSTONE || COMPILE_TEST
 	depends on COMMON_CLK
-	depends on PTP_1588_CLOCK
+	#depends on PTP_1588_CLOCK
 	help
 	  This driver supports the Common Platform Time Sync unit of
 	  the CPSW Ethernet Switch and Keystone 2 1g/10g Switch Subsystem.
@@ -226,7 +226,7 @@ config TI_PTP_BC
        tristate "TI Boundary Clock Support"
        depends on TI_CPSW || TI_PRUETH
        select PTP_1588_CLOCK
-       ---help---
+       help
          This driver supports PTP boundary clock that includes more
          than one physical clock, such as CPTS and ICSS-IEP, as its
          constituent clocks with pps internal sync capability. It
@@ -236,7 +236,7 @@ config TI_PTP_BC
 config TI_1PPS_DM_TIMER
        bool "TI 1PPS dm timer implementation"
        depends on OMAP_DM_TIMER
-       ---help---
+       help
          This driver supports PTP 1PPS signal generation using dm timer. This
          feature is available at the AM571(4)x-idk platform with hardware
          rework and the similar hardware modifications will be required for
diff --git a/drivers/net/ethernet/ti/icss_iep.c b/drivers/net/ethernet/ti/icss_iep.c
index bae8f7c64665..b6ff981b1308 100644
--- a/drivers/net/ethernet/ti/icss_iep.c
+++ b/drivers/net/ethernet/ti/icss_iep.c
@@ -592,8 +592,6 @@ static int icss_iep_perout_enable(struct icss_iep *iep,
        }
 
 	spin_lock_irqsave(&iep->irq_lock, flags);
-	if (iep->cap_cmp_irq)
-		hrtimer_cancel(&iep->sync_timer);
 	ret = icss_iep_perout_enable_hw(iep, req, on);
 	if (!ret)
 		iep->perout_enabled = !!on;
-- 
2.17.1

